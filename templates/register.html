{% extends "base.html" %}

{% block title %}KayÄ±t - GeliÅŸmiÅŸ Kimlik DoÄŸrulama{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-logo">
        <i class="fas fa-user-plus"></i>
    </div>
    <h2 class="auth-title">Yeni Hesap OluÅŸtur</h2>

    {% if error %}
    <div class="error-message text-center">
        <i class="fas fa-exclamation-circle"></i> {{ error }}
    </div>
    {% endif %}

    <form method="POST" action="{{ url_for('register') }}" id="registerForm">
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="username" name="username" placeholder="KullanÄ±cÄ± AdÄ±" required>
            <label for="username">ğŸ‘¤ KullanÄ±cÄ± AdÄ±</label>
        </div>

        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
            <label for="email">ğŸ“§ Email</label>
        </div>

        <div class="form-floating mb-3">
            <input type="password" class="form-control" id="password" name="password" placeholder="Åifre" required>
            <label for="password">ğŸ”’ Åifre</label>
            <div id="passwordStrength" class="mt-2" style="font-size: 0.9em;"></div>
        </div>

        <div class="form-floating mb-3">
            <select class="form-select" id="security_question" name="security_question" required>
                <option value="">SeÃ§iniz...</option>
                <option value="Ä°lk evcil hayvanÄ±nÄ±zÄ±n adÄ± nedir?">Ä°lk evcil hayvanÄ±nÄ±zÄ±n adÄ± nedir?</option>
                <option value="Annenizin kÄ±zlÄ±k soyadÄ± nedir?">Annenizin kÄ±zlÄ±k soyadÄ± nedir?</option>
                <option value="Ä°lk okulunuzun adÄ± nedir?">Ä°lk okulunuzun adÄ± nedir?</option>
                <option value="DoÄŸduÄŸunuz ÅŸehir neresidir?">DoÄŸduÄŸunuz ÅŸehir neresidir?</option>
                <option value="En sevdiÄŸiniz Ã¶ÄŸretmenin adÄ± nedir?">En sevdiÄŸiniz Ã¶ÄŸretmenin adÄ± nedir?</option>
            </select>
            <label for="security_question">ğŸ”‘ GÃ¼venlik Sorusu</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="security_answer" name="security_answer" placeholder="Cevap" required>
            <label for="security_answer">ğŸ— GÃ¼venlik Sorusu CevabÄ±</label>
        </div>

        <button type="submit" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Hesap OluÅŸtur
        </button>
    </form>

    <div class="text-center mt-4">
        <a href="{{ url_for('login') }}" class="nav-link">
            <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Åifre gÃ¶ster/gizle fonksiyonu
    const passwordInput = document.getElementById('password');
    const togglePassword = document.createElement('button');
    togglePassword.type = 'button';
    togglePassword.className = 'btn btn-link position-absolute end-0 top-50 translate-middle-y text-white';
    togglePassword.innerHTML = '<i class="fas fa-eye"></i>';
    togglePassword.style.zIndex = '10';
    
    togglePassword.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
    });
    
    passwordInput.parentElement.style.position = 'relative';
    passwordInput.parentElement.appendChild(togglePassword);

    // Åifre gÃ¼cÃ¼ kontrolÃ¼
    function checkPasswordStrength(password) {
        let strength = 0;
        const feedback = [];

        if (password.length < 8) {
            feedback.push('En az 8 karakter olmalÄ±');
        } else {
            strength += 1;
        }

        if (password.match(/[A-Z]/)) {
            strength += 1;
        } else {
            feedback.push('En az bir bÃ¼yÃ¼k harf iÃ§ermeli');
        }

        if (password.match(/[a-z]/)) {
            strength += 1;
        } else {
            feedback.push('En az bir kÃ¼Ã§Ã¼k harf iÃ§ermeli');
        }

        if (password.match(/[0-9]/)) {
            strength += 1;
        } else {
            feedback.push('En az bir rakam iÃ§ermeli');
        }

        if (password.match(/[^A-Za-z0-9]/)) {
            strength += 1;
        } else {
            feedback.push('En az bir Ã¶zel karakter iÃ§ermeli');
        }

        return {
            strength: strength,
            feedback: feedback
        };
    }

    const strengthDiv = document.getElementById('passwordStrength');
    passwordInput.addEventListener('input', function() {
        const result = checkPasswordStrength(this.value);
        const strengthText = ['Ã‡ok ZayÄ±f', 'ZayÄ±f', 'Orta', 'Ä°yi', 'GÃ¼Ã§lÃ¼'];
        const strengthColor = ['#f44336', '#ff9800', '#ffeb3b', '#8bc34a', '#4caf50'];
        
        if (this.value) {
            let html = `<div style="color: ${strengthColor[result.strength-1]}">
                Åifre GÃ¼cÃ¼: ${strengthText[result.strength-1]}
            </div>`;
            
            if (result.feedback.length > 0) {
                html += `<div style="color: #f44336; margin-top: 5px">
                    ${result.feedback.join('<br>')}
                </div>`;
            }
            
            strengthDiv.innerHTML = html;
        } else {
            strengthDiv.innerHTML = '';
        }
    });

    // Form gÃ¶nderilmeden Ã¶nce kontrol
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const result = checkPasswordStrength(password);
        
        if (result.strength < 3) {
            e.preventDefault();
            alert('LÃ¼tfen daha gÃ¼Ã§lÃ¼ bir ÅŸifre seÃ§in!');
        }
    });
});
</script>
{% endblock %} 